---
layout: post
title: db2 SQL 收集
category: db
comments: true
---

### 递归
```sql
WITH N(LEVEL,CHAIN,ID,PID) AS
(
 SELECT 1,CAST(ID AS VARCHAR(100)),ID,PID
 FROM SOMETABLE
 WHER PID IS NULL
 UNION ALL
 SELECT N.LEVEL+1,N.CHAIN||','||N1.ID,N1.ID,N1.PID
 FROM SOMETABLE AS N1,N
 WHERE N.ID=N1.PID
)
```
### 备份表
* 物化查询表
```sql
--1.创建查询表
CREATE TABLE SOMETABLE_BAK AS (SELECT * FROM SOMETABLE)
DATA INITIALLY DEFERRED
REFESH DEFERRED;
--2.刷新数据
REFESH TABLE SOMETABLE_BAK;
--3.把查询表改成普通表
ALTER TABLE SOMETABLE_BAK DROP MATERIALIZED QUERY;
```
* 先create,再inert
```sql
CREATE TABLE SOMETABLE_BAK LIKE SOMETABLE;
INSERT INTO SOMETABLE_BAK SELECT * FROM SOMETABLE;
```
* 结果表
```sql
CREATE TABLE SOMETABLE_BAK AS (SELECT * FORM SOMETABLE) DEFINITION ONLY;
```
